# Документация проекта Surf Coffee Mini App для Telegram

## Введение

Данное приложение представляет собой Telegram Mini App для сети кофеен Surf Coffee. Приложение позволяет пользователям просматривать категории товаров, выбирать продукты, настраивать их модификаторы и оформлять заказы на самовывоз. Реализовано на базе Next.js и React с использованием Telegram WebApp API.

## Файловая структура

```
/
├─ src/
│  ├─ app/
│  │  ├─ surf/              # Основная страница Telegram Mini App  
│  │  │  └─ page.tsx        # Главная страница приложения 
│  │  ├─ layout.tsx         # Общий шаблон приложения
│  │  └─ globals.css        # Глобальные стили
│  ├─ components/
│  │  ├─ Surf/              # Компоненты для приложения Surf Coffee
│  │  │  ├─ HomeScreen.tsx      # Домашний экран
│  │  │  ├─ CategoriesScreen.tsx # Экран категорий товаров
│  │  │  ├─ ProductScreen.tsx    # Экран детализации продукта
│  │  │  ├─ CartScreen.tsx       # Экран корзины
│  │  │  ├─ CheckoutScreen.tsx   # Экран оформления заказа
│  │  │  ├─ OrdersScreen.tsx     # Экран истории заказов
│  │  │  └─ ProfileScreen.tsx    # Экран профиля пользователя
│  └─ context/
│     └─ TelegramContext.tsx     # Контекст для работы с Telegram API
├─ public/
│  └─ surf/                 # Статические изображения и ресурсы
└─ ...                      # Конфигурационные файлы (package.json, etc.)
```

## Интеграция с Telegram WebApp API

### TelegramContext

Приложение использует контекст React для взаимодействия с Telegram WebApp API:

```typescript
// Создаем и экспортируем контекст Telegram
const TelegramContext = createContext<TelegramContextType>({...});
export const useTelegram = () => useContext(TelegramContext);
```

Основные методы TelegramContext:

- `initializeTelegramApp()` - инициализирует приложение в Telegram, устанавливает настройки
- `enableFullScreen()` - включает полноэкранный режим
- `telegramHeaderPadding` - константа (100px) для отступа под интерфейс Telegram

### Инициализация приложения

При загрузке приложение выполняет следующие действия:

1. Вызывает `webApp.ready()` для сообщения Telegram о готовности
2. Выполняет `webApp.expand()` для расширения окна
3. Вызывает `webApp.requestFullscreen()` для запроса полноэкранного режима
4. Отключает вертикальные свайпы через `webApp.disableVerticalSwipes()`
5. Устанавливает цвета интерфейса Telegram под стиль приложения

### Система отступов под интерфейс Telegram

В приложении реализована система динамических отступов для корректного отображения в Telegram:

1. CSS-переменная `--telegram-header-padding` устанавливается в зависимости от экрана:
   ```typescript
   document.documentElement.style.setProperty(
     '--telegram-header-padding', 
     isFullScreenEnabled && currentScreen !== 'home' ? `${telegramHeaderPadding}px` : '0px'
   );
   ```

2. Верхний градиент для плавного перехода:
   ```typescript
   document.documentElement.style.setProperty(
     '--telegram-header-gradient',
     'linear-gradient(to bottom, #1D1816 90%, #1D1816 95%)'
   );
   ```

3. Для элементов, требующих отступа, используется стиль:
   ```typescript
   const contentStyle = {
     paddingTop: 'var(--telegram-header-padding)',
     transition: 'padding-top 0.3s ease'
   };
   ```

4. На экранах продуктов элементы (кнопки, категории) имеют отступ 100px от верха экрана через классы `top-[100px]`.

## Основные экраны и компоненты

### HomeScreen

- Отображает главный экран с логотипом и категориями
- Не имеет верхнего отступа (отличается от других экранов)
- Содержит основные категории товаров с изображениями

### CategoriesScreen

- Показывает список товаров выбранной категории
- Реализует плавные анимации появления товаров
- Оснащен кнопкой возврата на главный экран

### ProductScreen

Самый сложный компонент приложения:

- Отображает подробную информацию о продукте
- Управление фотографией продукта:
  - Динамическое изменение размера при скролле
  - Анимация сжатия/расширения
  - Pull-to-refresh для расширения фотографии
  - Автоматическое сжатие при скролле вверх

- Управление модификаторами товара:
  - Выбор размера (маленький, средний, большой)
  - Выбор молока для кофе (обычное, растительное и пр.)
  - Выбор сиропов с отображением цены
  - Дополнительные опции для еды

- Компонент имеет несколько логических частей:
  1. Фотография продукта с кнопкой закрытия
  2. Наезжающая шапка с информацией
  3. Модификаторы и опции
  4. Фиксированная кнопка добавления в корзину

- Отображение состава и аллергенов:
  ```typescript
  const getProductIngredients = () => {
    const category = product.category || 'coffee';
    // Разные составы в зависимости от категории и названия
    // ...
  }
  ```

### CartScreen

- Отображает добавленные товары в корзине
- Позволяет менять количество или удалять товары
- Содержит кнопку оформления заказа

### CheckoutScreen

- Интерфейс оформления заказа
- Выбор способа получения (только самовывоз)
- Выбор времени получения
- Выбор адреса через интеграцию с картой
- Форма для ввода контактных данных

### OrdersScreen

- История заказов пользователя
- Отображение статуса заказов
- Возможность повторного з��каза

### ProfileScreen

- Информация о пользователе
- Интеграция с данными профиля Telegram
- Настройки приложения

## Навигация между экранами

Реализована кастомная система навигации через состояние React:

```typescript
const transitionTo = (screen: 'home' | 'categories' | 'product' | 'cart' | 'orders', callback?: () => void) => {
  setIsTransitioning(true);
  // Сохраняем предыдущий экран для возможности возврата
  if ((screen === 'cart' || screen === 'orders') && currentScreen !== 'cart' && currentScreen !== 'orders') {
    setPreviousScreen(currentScreen);
  }
  // ...
};
```

Вспомогательные функции навигации:
- `goToCategories(category)` - переход к категории
- `goToProduct(product)` - переход к продукту
- `goHome()` - возврат на главную
- `goToCart()` - переход в корзину
- `goToOrders()` - переход к заказам
- `goBack()` - умный возврат с запоминанием предыдущего состояния

## Анимации и визуальные эффекты

В приложении используются различные анимации для улучшения UX:

1. Плавное появление элементов с использованием классов:
   ```
   transition-all duration-500 ${isLoaded ? 'opacity-100' : 'opacity-0'}
   ```

2. Расширение/сжатие фотографии продукта:
   ```
   transition-transform duration-1000 ${isLoaded ? 'scale-100' : 'scale-110'}
   ```

3. Эффект наезжающей шапки на фотографию продукта с классом `-mt-10 rounded-t-3xl`

4. Плавный переход между экранами:
   ```
   transition-opacity duration-300 ${isTransitioning ? 'opacity-0' : 'opacity-100'}
   ```

5. Динамическое изменение высоты фотографии при скролле:
   ```typescript
   const getImageHeight = () => {
     if (isImageExpanded) return '75%';
     // Определяем базовую высоту
     const baseHeight = 40; // 40% высоты экрана
     const minHeight = 25; // 25% минимум
     // ...расчет высоты...
   };
   ```

## Заключение

Приложение Surf Coffee Mini App представляет собой современное, интерактивное веб-приложение, оптимизированное для работы в Telegram. Оно использует передовые технологии фронтенд-разработки и тесно интегрируется с Telegram WebApp API для создания нативного пользовательского опыта.